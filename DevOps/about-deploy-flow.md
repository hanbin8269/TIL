# 통상적인 배포 흐름

배포를 시작하려고 하면 환경은 어떻게 분리해야 하고 **통상적인 프로세스가** 어떻게 흘러가는지 궁금할 때가 있다. 순서대로 알아보자.

## 배포 환경의 종류
개발을 하다보면 여러 환경을 두어 개발해야 한다는 것을 느낄 수 있다.
- 개발자가 개발을 하는 **Local 환경**
- 개발자들 끼리 통합 테스트를 하는 **Development 환경**
- 개발이 끝나고 QA 엔지니어 및 내부 사용자들이 사용해 보기 위한 **QA 환경**
- 실제 유저가 사용하는 **Production 환경**

위와 같이 환경을 나누면 보안적이고 안정적으로 서비스를 운영하고 개발할 수 있다.

하지만 환경이 여러개이니 만큼 데이터베이스 비밀번호, JWT Secret Key 등의 환경변수에 차이점이 있는데, 이를 관리하는 방법을 알아보자

### 여러 배포 환경의 환경 변수 관리
여러 배포환경의 관리에서 핵심은 **인프라를 모듈화 하여 어떤것이 변수인지 잘 선정하고 이를 잘 설계하는 것**이다.
현재 배포하고 있는 환경이 어떤 환경인지 (DEV, QA, PROD) 설정하고 다양한 **환경 변수 (DATABASE_PWD, SECREY_KEY, etc.)** 들을 환경에 맞게 가져다 쓰는 것이 핵심이다.

AWS 에서는 이런 중요한 정보를 관리하기 위해 **Parameter Store**를 제공한다. [링크](https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/systems-manager-parameter-store.html)

## 개발 프로세스
1. 개발자가 **로컬 PC**에서 개발을 진행한다.
2. 다른 개발자가 작성한 코드와 차이가 발생하지 않는지 **내부 테스트를 진행**한다.
3. 진행한 내용을 다른 개발자와 **공유하기 위해 git과 같은 SCM에 올린다.** `ex) develop 브랜치`
4. develop 브랜치의 내용을 개발 환경에 배포하기 전에 **테스트와 Linting** 등 코드 포메팅을 한다.
5. 배포하기 위한 **빌드과정**을 거친다 `(인터프리터 언어는 해당 X)`
6. **코드를 배포**한다.
7. **테스트를 진행**한다.

위 모든 과정을 **DEV, QA, PROD** 환경에서 모두 하고 **각각에 맞는 환경에 배포**한다.

개발 프로세스에 대해 알아봤으면 좀 더 자세한 배포 방법 대해서 알아보자

## 예시 배포 방법
내가 학교 서버에 프로젝트를 올리고 관리했던 방식이다. 무조건 맞는 방법은 아니지만 이 방식을 사용하면서 CI/CD 관리가 편리해졌다.

1. **로컬 PC**에서 개발을 진행한다.
2. **개발이 완료된 소스 코드**를 github에 push한다.
    2-1. `github action`과 `pytest`를 이용해 해당 브랜치 자동 테스팅을 하고, `PR` 시에도 미리 테스트 결과를 볼 수 있도록 했다.
    2-2. `git-flow` 방식을 사용해 프로젝트를 관리했다.
3. `Ubuntu OS`가 설치된 학교 서버에 `Jenkins`, `Docker` 등을 설치해 환경을 구축했다.
4. `Jenkins` 대시보드에서 `Build` 버튼을 누르면 `develop` 브랜치의 `Jenkinsfile`을 읽어 자동으로 `Docker Build, Run`등의 명령어가 실행 되도록 했다.